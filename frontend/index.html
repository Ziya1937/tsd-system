<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Учёт ТСД</title>
  <style>
    .cell {
      width: 120px;
      height: 100px;
      margin: 10px;
      font-size: 18px;
      border: none;
      background: green;
      color: white;
      border-radius: 6px;
      cursor: pointer;
    }
    .busy {
      background: red !important;
    }
  </style>
</head>
<body>
  <h2>Выберите ячейку</h2>
  <div id="cell-container"></div>

  <script>
    const cellContainer = document.getElementById("cell-container");
    const totalCells = 10;

    for (let i = 1; i <= totalCells; i++) {
      const btn = document.createElement("button");
      btn.innerText = `Ячейка ${i}`;
      btn.className = "cell";
      btn.onclick = async () => {
        await fetch('/select-cell', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ cell: i })
        });
        alert("Приложите бейдж");
      };
      btn.id = `cell-${i}`;
      cellContainer.appendChild(btn);
    }

  setInterval(async () => {
    try {
      const res = await fetch('/status');
      const status = await res.json();

      for (let i = 1; i <= totalCells; i++) {
        const btnId = `cell-${i}`;
        const btn = document.getElementById(btnId);

        if (btn && status[i] && status[i].busy) {
          btn.classList.add("busy");
        } else if (btn) {
          btn.classList.remove("busy");
        }
      }
    } catch (err) {
      console.error("Ошибка при обновлении статуса ячеек:", err);
    }
  }, 1000);
</script>
  </script>
</body>
</html>